{{ 'modal-section.css' | asset_url | stylesheet_tag }}

  <div class="gdr-modal {% if section.settings.test_mode %}gdr-modal--test-mode{% endif %}" 
     data-section-id="{{ section.id }}" 
     data-delay="{{ section.settings.delay_time }}">
    <div class="gdr-modal__overlay" aria-hidden="true">
      <div class="gdr-modal__content" role="dialog" aria-modal="true">

        <button class="gdr-modal__close-btn" aria-label="Close modal">
          {% comment %} Using eager loading for icons too {% endcomment %}
          <img src="{{ 'x.svg' | asset_url }}" class="gdr-modal__close-icon" alt="" loading="eager" width="20" height="20">
        </button>

        <div class="gdr-modal__hero">
          {% comment %} Logo: Pull alt from image object if text field is empty {% endcomment %}
          {%- liquid
            assign logo_alt = section.settings.modal_logo.alt | default: section.settings.modal_logo_alt
            assign main_alt = section.settings.modal_image.alt | default: section.settings.modal_image_alt
          -%}

          {% if section.settings.modal_logo %}
            {{ section.settings.modal_logo | image_url: width: 500 | image_tag: class: 'gdr-modal__logo', alt: logo_alt, loading: 'eager' }}
          {% else %}
            <img src="{{ 'goodr_logo_white.svg' | asset_url }}" class="gdr-modal__logo" alt="Logo" loading="eager" width="200" height="auto">
          {% endif %}

          {% comment %} Desktop Background {% endcomment %}
          {% if section.settings.modal_image %}
            {{ section.settings.modal_image | image_url: width: 1000 | image_tag: class: 'gdr-modal__image gdr-modal__image--desktop', alt: main_alt, loading: 'eager', widths: '484, 748, 1000' }}
          {% else %}
            <img src="{{ 'desktop_popup_img.png' | asset_url }}" class="gdr-modal__image gdr-modal__image--desktop" alt="Desktop Background" loading="eager" width="100%" height="auto">
          {% endif %}
          
          {% comment %} Mobile Background {% endcomment %}
          {% if section.settings.modal_image_mobile %}
            {{ section.settings.modal_image_mobile | image_url: width: 600 | image_tag: class: 'gdr-modal__image gdr-modal__image--mobile', alt: main_alt, loading: 'eager', widths: '326, 600' }}
          {% elsif section.settings.modal_image %}
            {{ section.settings.modal_image | image_url: width: 600 | image_tag: class: 'gdr-modal__image gdr-modal__image--mobile', alt: main_alt, loading: 'eager' }}
					{% else %}
						<img 
							src="{{ 'mobile_popup_img.png' | asset_url }}" 
							class="gdr-modal__image gdr-modal__image--mobile" 
							alt="Mobile Background" 
							loading="eager" 
							width="326" 
							height="auto"
						>
          {% endif %}
        </div>

        	{% comment %} Only show text if description or discount code exists {% endcomment %}
					{%- liquid
						assign discount_span = '<span class="gdr-modal__discount-code">' | append: section.settings.discount_code | append: '</span>'
						assign description_text = section.settings.modal_description | default: "USE CODE [code] FOR $5 OFF YOUR FIRST ORDER"
						assign formatted_description = description_text | replace: '[code]', discount_span
					-%}

					{% if formatted_description != blank %}
						<p class="gdr-modal__description">{{ formatted_description }}</p>
					{% endif %}

        <div class="gdr-modal__button-group">
          <a class="gdr-modal__button--confirm" href="{{ section.settings.confirm_button_link }}">
            {{ section.settings.confirm_button_text | default: 'SHOP NOW' }}
          </a>
          <button class="gdr-modal__button--decline" type="button">
            {{ section.settings.decline_button_text | default: 'No Thanks' }}
          </button>
        </div>
      </div>
    </div>
  </div>

<script src="{{ 'modal-section.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Modal Popup",
  "settings": [
    {
      "type": "header",
      "content": "Images"
    },
    {
      "type": "image_picker",
      "id": "modal_logo",
      "label": "Logo"
    },
    {
      "type": "text",
      "id": "modal_logo_alt",
      "label": "Logo Alt Text",
      "default": "Modal Logo"
    },
    {
      "type": "image_picker",
      "id": "modal_image",
      "label": "Desktop Image"
    },
    {
      "type": "image_picker",
      "id": "modal_image_mobile",
      "label": "Mobile Image (Optional)"
    },
    {
      "type": "text",
      "id": "modal_image_alt",
      "label": "Image Alt Text",
      "default": "Modal Image"
    },
    {
      "type": "header",
      "content": "Text & Copy"
    },
    {
      "type": "text",
      "id": "modal_description",
      "label": "Description",
      "default": "USE CODE [code] FOR $5 OFF YOUR FIRST ORDER",
      "info": "Use [code] as a placeholder for the discount code"
    },
    {
      "type": "text",
      "id": "discount_code",
      "label": "Discount Code",
      "default": "GOODR5"
    },
    {
      "type": "header",
      "content": "Buttons"
    },
    {
      "type": "text",
      "id": "confirm_button_text",
      "label": "Confirm Button Text",
      "default": "SHOP ALL STYLES"
    },
    {
      "type": "url",
      "id": "confirm_button_link",
      "label": "Confirm Button Link",
      "default": "/collections/all"
    },
    {
      "type": "text",
      "id": "decline_button_text",
      "label": "Decline Button Text",
      "default": "NAH, I HATE DEALS"
    },
    {
      "type": "header",
      "content": "Advanced Settings"
    },
    {
      "type": "range",
      "id": "delay_time",
      "min": 1,
      "max": 20,
      "step": 1,
      "unit": "sec",
      "label": "Delay Before Showing",
      "default": 2
    },
    {
      "type": "checkbox",
      "id": "test_mode",
      "label": "Force Open (Test Mode)",
      "default": false,
      "info": "Check this to keep the modal open while you style it in the editor"
    }
  ],
  "presets": [
    {
      "name": "Modal Popup"
    }
  ]
}
{% endschema %}